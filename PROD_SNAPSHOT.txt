Moving a production snapshot to development server
==================================================

Steps to follow for testing all code for upgrade to July 2015 theme, with a snapshot of the production database.

On production server
--------------------

- Copy Data.fs to development server.
- tar/gzip blobstorage and copy to development server.

On development server
---------------------

**Jazkarta steps:**

- From ZMI, export isaw-home and home-slides to somewhere on the file system where you can get them back 
  later (irrelevant if you don't have an existing database that's been customized with same, e.g. on a 
  local dev environment).
- Change directory to /srv/isaw.web.
- Stop all supervisor processes (bin/supervisorctl stop all).
- Copy old Data.fs (var/filestorage/Data.fs) to Data.fs.old.
- Move blobstorage (var/blobstorage) to blobstorage.old.
- Move Data.fs from production to filestorage directory.
- Move blobstorage.tgz from production to var directory and untar/ungzip.
- Make sure user.group for Data.fs and blobstorage is set to plone.jazkarta.
- Add isaw.events to cfg/sources.cfg and cfg/base.cfg.
- Run buildout (bin/buildout -N).
- Start supervisor processes (bin/supervisorctl start all).
- Browse to /isaw/portal_skins/custom/manage_main and delete everything there.
- Browse to /isaw/portal_view_customizations/manage_main and delete everything.
- Browse to /isaw/events/manage_interfaces and remove isaw.events interfaces.
- Browse to /isaw/prefs_install_products_form and uninstall isaw.events.
- From the same place uninstall Dropdown Menu and collective.navigationtoggle.
- Browse to /isaw/plone-upgrade and run Plone upgrade steps.
- From the same place, run upgrade steps for isaw.policy and isaw.theme.
- From ZMI, remove isaw-home. Import isaw-home and home-slides from FS.
- Stop all supervisor processes (bin/supervisorctl stop all).
- Remove isaw.events from cfg/sources.cfg and cfg/base.cfg.
- Run buildout (bin/buildout -N).
- Start supervisor processes (bin/supervisorctl start all).

**ISAW steps:**

*Fix up events listing*

- Browse to /events and add a Collection "Event Home" with criteria set to:
  - Type: Event
  - Event start date: After Today
  - Review State: Published Internally, Internally Published, Published Externally
  - Sort on: Event start date
- Set display on collection to Event Listing
- Use "Manage Portlets" link to add a calendar portlet to the right column
- Set state of "Event Home" to published (submit for publication -> publish)
- Browse to /events and use "Manage Portlets" to disable the calendar portlet in the right column.
- Return to /events and use the Display menu to "Select content item as default view" and select "Event Home"

*Fix up people listings*

- Browse to /people/faculty and change "Display" to "People listing"
- Do the same for:
    + /people/staff
    + /people/visiting-research-scholars
    + /people/students
    + /people/research-associates/
    + each year subfolder under /people/alumni

*Fix up blog listings*

(main, library)

*Check main navigation*

- Secondary (top bar) should be: "About ISAW", "People", "Library", "Resources & Publications", "Research", "News", [[search icon]]
- Primary (secondary bar) should be: "Graduate Studies", "Visiting Scholars", "Events", "Exhibitions"

*Fix up secondary navigation (left nav portlets)*

- Visit the following sectionss of the site and make indicated adjustments:
    + /about/@@manage-portlets : remove the "About ISAW" (right nav) portlet
    + 

*Get rid of evil featured item portlet FOREVER!*
